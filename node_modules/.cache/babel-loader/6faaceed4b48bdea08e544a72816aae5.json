{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport axios from 'axios';\nimport jwt_decode from \"jwt-decode\";\nimport { useContext } from 'react';\nimport { AuthContext } from '../context/AuthContext';\n\nconst useRefreshToken = () => {\n  _s();\n\n  const {\n    userAuth,\n    setUserAuth\n  } = useContext(AuthContext);\n  const baseURL = \"http://localhost:8080/api\";\n  const refreshURL = `${baseURL}/users/token/refresh`;\n  const axiosInstance = axios.create({\n    baseURL: baseURL,\n    timeout: 10000,\n    headers: {\n      'Authorization': `Bearer ${userAuth.accessToken}`\n    }\n  });\n  axiosInstance.interceptors.request.use(async request => {\n    // const decodedToken = jwt_decode(userAuth.accessToken);\n    // const tokenExpirationDate = decodedToken.exp;\n    // const currentTime = new Date().getTime() / 1000;\n    // const isValid = tokenExpirationDate > currentTime;\n    // if (isValid) return request;\n    // const config = {\n    // \theaders: {\n    // \t\t'Authorization': `Bearer ${userAuth.refreshToken}`\n    // \t}\n    // }\n    // const response = await axios.get(refreshURL, config);\n    // window.localStorage.setItem(\"access_token\", response.data.access_token);\n    // setUserAuth(prevState => ( {\n    // \tusername: prevState.username,\n    // \taccessToken: response.data.access_token,\n    // \trefreshToken: prevState.refreshToken\n    // }));\n    // request.headers.Authorization = `Bearer ${response.data.access_token}`;\n    return request;\n  }, error => {\n    return Promise.reject(error);\n  });\n  axios.interceptors.response.use(response => {\n    console.log(\"Hi\");\n    return response;\n  }, async error => {\n    // if (!error.data.error_message) return error;\n    console.log(\"Hi\"); // const config = {\n    // \theaders: {\n    // \t\t'Authorization': `Bearer ${userAuth.refreshToken}`\n    // \t}\n    // }\n    // const newResponse = await axios.get(`${baseURL}/api/users/token/refresh`, config);\n    // window.localStorage.setItem(\"access_token\", newResponse.data.access_token);\n    // setUserAuth(prevState => ( {\n    // \tusername: prevState.username,\n    // \taccessToken: newResponse.data.access_token,\n    // \trefreshToken: prevState.refreshToken\n    // }));\n    // axios.request.headers.Authorization = `Bearer ${newResponse.data.access_token}`;\n    // return axios.request;\n\n    return error;\n  });\n  return axiosInstance;\n};\n\n_s(useRefreshToken, \"dRy7P6vBdAhkDNVwznNO7obL4K8=\");\n\nexport default useRefreshToken;","map":{"version":3,"sources":["/Users/agusespa/Programming/Projects/self-okrs-ui/src/utils/useRefreshToken.js"],"names":["axios","jwt_decode","useContext","AuthContext","useRefreshToken","userAuth","setUserAuth","baseURL","refreshURL","axiosInstance","create","timeout","headers","accessToken","interceptors","request","use","error","Promise","reject","response","console","log"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,SAASC,UAAT,QAA2B,OAA3B;AACA,SAASC,WAAT,QAA4B,wBAA5B;;AAEA,MAAMC,eAAe,GAAG,MAAM;AAAA;;AAE1B,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,MAA4BJ,UAAU,CAACC,WAAD,CAA5C;AAEH,QAAMI,OAAO,GAAG,2BAAhB;AACA,QAAMC,UAAU,GAAI,GAAED,OAAQ,sBAA9B;AAEA,QAAME,aAAa,GAAGT,KAAK,CAACU,MAAN,CAAa;AAClCH,IAAAA,OAAO,EAAEA,OADyB;AAElCI,IAAAA,OAAO,EAAE,KAFyB;AAGlCC,IAAAA,OAAO,EAAE;AAAE,uBAAkB,UAASP,QAAQ,CAACQ,WAAY;AAAlD;AAHyB,GAAb,CAAtB;AAMAJ,EAAAA,aAAa,CAACK,YAAd,CAA2BC,OAA3B,CAAmCC,GAAnC,CAAuC,MAAMD,OAAN,IAAiB;AAEvD;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA,WAAOA,OAAP;AAEA,GA7BD,EA6BGE,KAAK,IAAI;AACX,WAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACA,GA/BD;AAkCAjB,EAAAA,KAAK,CAACc,YAAN,CAAmBM,QAAnB,CAA4BJ,GAA5B,CAAiCI,QAAQ,IAAI;AAC5CC,IAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACA,WAAOF,QAAP;AAEC,GAJF,EAII,MAAMH,KAAN,IAAe;AAElB;AAEAI,IAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ,EAJkB,CAMlB;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEA,WAAOL,KAAP;AACA,GA9BD;AAgCG,SAAOR,aAAP;AACH,CAhFD;;GAAML,e;;AAkFN,eAAeA,eAAf","sourcesContent":["import axios from 'axios';\nimport jwt_decode from \"jwt-decode\";\nimport { useContext } from 'react';\nimport { AuthContext } from '../context/AuthContext';\n\nconst useRefreshToken = () => {\n\n    const { userAuth, setUserAuth } = useContext(AuthContext);\n\n\tconst baseURL = \"http://localhost:8080/api\";\n\tconst refreshURL = `${baseURL}/users/token/refresh`; \n\n\tconst axiosInstance = axios.create({\n\t\tbaseURL: baseURL,\n\t\ttimeout: 10000,\n\t\theaders: { 'Authorization': `Bearer ${userAuth.accessToken}`}\n\t});\n\n\taxiosInstance.interceptors.request.use(async request => {\n\n\t\t// const decodedToken = jwt_decode(userAuth.accessToken);\n\t\t// const tokenExpirationDate = decodedToken.exp;\n\t\t// const currentTime = new Date().getTime() / 1000;\n\t\n\t\t// const isValid = tokenExpirationDate > currentTime;\n\t\n\t\t// if (isValid) return request;\n\n\t\t// const config = {\n\t\t// \theaders: {\n\t\t// \t\t'Authorization': `Bearer ${userAuth.refreshToken}`\n\t\t// \t}\n\t\t// }\n\n\t\t// const response = await axios.get(refreshURL, config);\n\t\t\t\t\n\t\t// window.localStorage.setItem(\"access_token\", response.data.access_token);\n\n\t\t// setUserAuth(prevState => ( {\n\t\t// \tusername: prevState.username,\n\t\t// \taccessToken: response.data.access_token,\n\t\t// \trefreshToken: prevState.refreshToken\n\t\t// }));\n\t\t\n\t\t// request.headers.Authorization = `Bearer ${response.data.access_token}`;\n\t\treturn request;\n\n\t}, error => {\n\t\treturn Promise.reject(error);\n\t});\n\n\n\taxios.interceptors.response.use( response => {\n\t\tconsole.log(\"Hi\");\n\t\treturn response;\n\t\t\n\t\t}, async error => {\n\n\t\t// if (!error.data.error_message) return error;\n\n\t\tconsole.log(\"Hi\");\n\n\t\t// const config = {\n\t\t// \theaders: {\n\t\t// \t\t'Authorization': `Bearer ${userAuth.refreshToken}`\n\t\t// \t}\n\t\t// }\n\n\t\t// const newResponse = await axios.get(`${baseURL}/api/users/token/refresh`, config);\n\t\t\t\t\t\n\t\t// window.localStorage.setItem(\"access_token\", newResponse.data.access_token);\n\n\t\t// setUserAuth(prevState => ( {\n\t\t// \tusername: prevState.username,\n\t\t// \taccessToken: newResponse.data.access_token,\n\t\t// \trefreshToken: prevState.refreshToken\n\t\t// }));\n\t\t\t\n\t\t// axios.request.headers.Authorization = `Bearer ${newResponse.data.access_token}`;\n\t\t// return axios.request;\n\n\t\treturn error;\n\t});\n    \n    return axiosInstance;\n}\n\nexport default useRefreshToken;"]},"metadata":{},"sourceType":"module"}